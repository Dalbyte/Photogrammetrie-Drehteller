<!DOCTYPE html>
<html>

<head>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style>

/*CONTAINERDESIGN*/
        body {
            background-color: #FD4659;
        }

        @font-face {
            font-family: PressStart2P-Regular;
            src: url(PressStart2P-Regular.ttf);
        }

        div {
            font-family: PressStart2P-Regular;
            text-align: center;
            color: #4A0100;
            margin-bottom: 1vh;
        }

        .box {
            float: left;
            width: 49.1%;
            padding: 0 px;
            border: 0.4vw solid #4A0100;
            /* border: 10px solid #4A0100;
           background-color: #4A0100;
            box-sizing: border-box; */
        }

        .box2 {
            float: right;
            width: 49.1%;
            padding: 0 px;
            border: 0.4vw solid #4A0100;
            /* border: 10px solid #4A0100;
           background-color: #4A0100;
             box-sizing: border-box; */
        }

/*SCHRIFT*/
        h1 {
            font-family: PressStart2P-Regular;
            line-height: 1.4;
            text-align: center;
            color: #fff;
        }

        h5 {
            font-family: PressStart2P-Regular;
            line-height: 1.4;
            text-align: center;
            color: #fff;
        }

/*SLIDERDESIGN*/
        .slider {
            -webkit-appearance: none;
            width: 90%;
            height: 35px;
            background: #FDB0C0;
            outline: none;
            opacity: 0.7;
            -webkit-transition: .2s;
            transition: opacity .2s;
        }

        .slider:hover {
            opacity: 1;
        }

        .slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 35px;
            height: 35px;
            background: #4A0100;
            cursor: pointer;
        }

        .slider::-moz-range-thumb {
            width: 35px;
            height: 35px;
            background: #4A0100;
            cursor: pointer;
        }

/*BUTTONDESIGN*/
        .button {
            border-radius: 0px;
            background: #FD4659;
            box-shadow: 5px 5px 0px #6f1f27,
                -5px -5px 0px #ff6d8b;
        }

/*CANVAS*/
        canvas {
            width: 100%;
            height: 40%;
            image-rendering: -moz-crisp-edges;
            image-rendering: -webkit-crisp-edges;
            image-rendering: pixelated;
            image-rendering: crisp-edges;
        }
    </style>
</head>

<body>

    <!--HEADER Pixelwiederholung-->
    <canvas id="header" width="200" height="80"></canvas>
    <script>
        // get canvas context
        var ctx = document.getElementById('header').getContext('2d');
        // load image
        var image = new Image();
        image.onload = function () {
            // draw the image into the canvas
            ctx.drawImage(image, 0, 0);
        }
        image.src = 'pixelart.gif';
    </script>

    <!--SLIDER BESCHRIFTUNG-->
    <div class="slidecontainer">
        <div class="box">
            <h5>Photogrammetrie<br>Drehteller</h5>
        </div>
        <div class="box2">
            <h5>Version<br>2.0</h5>
        </div>
    </div>

    <!--SLIDER-->
    <div class="slidecontainer">
        
        
        
    <!--FRAME ANZAHL AUF EINE 360-->   
        <input id="FrameTo360" type="range" class="slider" min="1" max="360" step="1" value="12" oninput="sendtoScanner();">
        <p>frame per 360° : <span id="FrameOutput"></span></p><br>
    
    <!--DELAY-->
        <input id="TimeRang" type="range" class="slider" min="1" max="30" step="1" value="3" oninput="sendtoScanner();">
        <p>second per frame: <span id="TimeOutput"></span>s</p>
        <br>

    <!--BUTTON-->
        <button onclick="sendButtonStepPlus()" class="button set" id="save">
            <h5>&lsaquo;- Step + Photo</h5>
        </button>
        <button onclick="sendButtonStepPlus()" class="button set" id="save">
            <h5>&lsaquo;- Step</h5>
        </button>
        <button onclick="sendButtonStart()" class="button start">
            <h5>Start</h5>
        </button>
        <button onclick="sendButtonStepPlus()" class="button set" id="save">
            <h5>Step -&rsaquo;</h5>
        </button>
        <button onclick="sendButtonStepPlusPhoto()" class="button set" id="save">
            <h5>Step + Photo -&rsaquo;</h5>
        </button>
    </div>

    <!--QueryLink

    /* 
        // Query Part
        const queryStr = 'frame=5&delay=3';
        const queryToAdd = new URLSearchParams(queryStr);
        var savebutton = document.getElementById('save');

        // Slider Photo
        var slider = document.getElementById("FrameTo360");
        var output = document.getElementById("demo");
        output.innerHTML = slider.value;

        slider.oninput = function () {
            output.innerHTML = this.value;
            queryToAdd.set('frame',slider.value);
            console.log(queryToAdd.toString());

            var queryUrl = "http://192.168.1.1/save?" + queryToAdd.toString();
            console.log(queryUrl);
            savebutton.setAttribute("onclick","location.href = '"+ queryUrl.toString()+"'");
        }

        // Slider Time
        var TimeSlider = document.getElementById("TimeRang");
        var TimeOutput = document.getElementById("Time");
        TimeOutput.innerHTML = TimeSlider.value;

        TimeSlider.oninput = function () {
            TimeOutput.innerHTML = TimeSlider.value;
            queryToAdd.set('delay',TimeSlider.value);
            console.log(queryToAdd.toString());
            var queryUrl = "http://192.168.1.1/save?" + queryToAdd.toString();
            console.log(queryUrl);
            savebutton.setAttribute("onclick","location.href = '"+ queryUrl.toString()+"'");
        }
    -->

    <!--WEBSOCKET SLIDER SKRIPT-->

    <script>
        
        // var connection = new WebSocket("ws://" + location.hostname + ":81/", ["arduino"]); 
        var connection = new WebSocket("ws://" + "192.168.178.151" + ":81/", ["arduino"]);
        
        connection.onopen = function () {
            connection.send("Connect " + new Date());
            WebsocketFehler = false;
        };

        connection.onerror = function (error) {
            console.log("WebSocket Error ", error);
            
            // Add Fehlermeldung Websocket Problem
            if(!WebsocketFehler){
                WebsocketFehler = true;
                
                let Nachricht = WebsocketFehlerCode(error);
                Fehlermeldung("Websocket Error: ", Nachricht);
                
                console.log(error);
            }

        };
        
        connection.onclose = function(){
            console.log("Websocket ist geschlossen");
        }

        connection.onmessage = function (e) {
            console.log("Server: ", e.data);
            WebsocketFehler = false;
        };

        // Get Slider Daten and Send
        function sendtoScanner() {
            
            // Get Data
            var framecount = document.getElementById("FrameTo360").value;
            var timedelay = document.getElementById("TimeRang").value;
            
            console.log("FrameTo360: "+framecount);
            console.log("TimeRang: "+timedelay);
            
            // HTML DATA
            let FrameOutput = document.getElementById("FrameOutput");
            let TimeOutput = document.getElementById("TimeOutput");
            FrameOutput.innerHTML = framecount;
            TimeOutput.innerHTML = timedelay;
            
            // Struktur Data
            let dataObj = {
                "FrameTo360" : framecount,
                "TimeRang": timedelay
            }
            
            var dataJSON = JSON.stringify(dataObj);
            
            // Send Data
            var rgb = "#";
            console.log(dataJSON);
            connection.send(dataJSON);
        }
        
        // Alle Button
        function sendButtonStart() {
            var button = "#"+"Start";
            console.log(button);
            connection.send(button);
        }
        
        function sendButtonStepPlus() {
            var button = "#"+"StepPlus";
            console.log(button);
            connection.send(button);
        }
        
        function sendButtonStepMinus() {
            var button = "#"+"StepMinus";
            console.log(button);
            connection.send(button);
        }
        
        function sendButtonStepPlusPhoto() {
            var button = "#"+"StepPlusPhoto";
            console.log(button);
            connection.send(button);
        }
        
        function sendButtonStepMinusPhoto() {
            var button = "#"+"StepMinusPhoto";
            console.log(button);
            connection.send(button);
        }
        
        
        // Aktive Fehlermeldungen
            
            // Connection Stuff
            var WebsocketFehler = false;
            
            // Fehler Code wird in String umgewandelt
            function WebsocketFehlerCode (error){
                let State = error.__proto__.BUBBLING_PHASE; // Nicht Ideal bei den Fehler Standart ist 3 = closed;
                let ReadyStateKonstanten = ["CONNECTING","OPEN","CLOSING","CLOSED"];
                return ReadyStateKonstanten[State]
            }
        
        // Fehler Meldung    
        
        function Fehlermeldung(Überschrift,Parameter) {
            
            // Container Fehlermeldung
            let FehlermeldungContainer = document.createElement("div");
            FehlermeldungContainer.setAttribute("class","slidecontainer");

            
            // Links
            let box = document.createElement("div");
            box.setAttribute("class", "box");
            let boxtxt = document.createElement("h5");
            boxtxt.innerHTML = Überschrift;
            box.appendChild(boxtxt);
            
            // Rechts
            let box2 = document.createElement("div");
            box2.setAttribute("class", "box2");
            let box2txt = document.createElement("h5");
            box2txt.innerHTML = Parameter;
            box2.appendChild(box2txt);
            
            // add SubContainer
            FehlermeldungContainer.appendChild(box); 
            FehlermeldungContainer.appendChild(box2); 
            
            
            // Add Container erste Position
            let webapp = document.body;
            webapp.insertBefore(FehlermeldungContainer,webapp.childNodes[0]);

        }
        
    </script>
</body>

</html>